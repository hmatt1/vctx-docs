{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "vctx",
  "scopeName": "source.vctx",
  "fileTypes": [
    "vctx"
  ],
  "patterns": [
    { "include": "#comments" },
    { "include": "#attributes" },
    { "include": "#top_level_declarations" },
    { "include": "#statements" },
    { "include": "#expressions" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        { "name": "comment.block.vctx", "begin": "/\\*", "end": "\\*/" },
        { "name": "comment.line.double-slash.vctx", "begin": "//", "end": "$" }
      ]
    },
    "attributes": {
      "name": "meta.attribute.vctx",
      "match": "(@)([a-zA-Z_][a-zA-Z0-9_]*)",
      "captures": {
        "1": { "name": "variable.annotation.vctx" },
        "2": { "name": "variable.annotation.vctx" }
      }
    },
    "top_level_declarations": {
      "patterns": [
        {
          "match": "\\b(import)\\s+([a-zA-Z0-9_\\.]+)(?:\\s+(as)\\s+([a-zA-Z_][a-zA-Z0-9_]*))?",
          "captures": {
            "1": { "name": "keyword.control.import.vctx" },
            "2": { "name": "entity.name.namespace.vctx" },
            "3": { "name": "keyword.control.import.as.vctx" },
            "4": { "name": "entity.name.namespace.vctx" }
          }
        },
        {
          "begin": "\\b(component)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\b",
          "beginCaptures": {
            "1": { "name": "storage.type.class.component.vctx" },
            "2": { "name": "entity.name.type.class.vctx" }
          },
          "end": "(?=\\{)",
          "patterns": [
            { "include": "#generics" },
            { "include": "#comments" },
            {
              "begin": "\\(",
              "end": "\\)",
              "patterns": [
                {
                  "match": "\\b(in|out)\\b",
                  "name": "storage.type.vctx"
                },
                {
                  "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(:)",
                  "captures": {
                    "1": { "name": "variable.parameter.port.vctx" },
                    "2": { "name": "punctuation.separator.type.vctx" }
                  }
                },
                { "include": "#types" },
                { "include": "#keywords" }
              ]
            }
          ]
        },
        {
          "begin": "\\b(function|sim|formal)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\b",
          "beginCaptures": {
            "1": { "name": "storage.type.function.vctx" },
            "2": { "name": "entity.name.function.vctx" }
          },
          "end": "(?=\\{|->)",
          "patterns": [
            { "include": "#comments" },
            {
              "begin": "\\(",
              "end": "\\)",
              "patterns": [
                {
                  "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(:)",
                  "captures": {
                    "1": { "name": "variable.parameter.vctx" },
                    "2": { "name": "punctuation.separator.type.vctx" }
                  }
                },
                { "include": "#types" }
              ]
            }
          ]
        },
        {
          "begin": "\\b(struct|bundle)\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\b",
          "beginCaptures": {
            "1": { "name": "storage.type.struct.vctx" },
            "2": { "name": "entity.name.type.struct.vctx" }
          },
          "end": "(?=\\{)",
          "patterns": [ { "include": "#comments" } ]
        }
      ]
    },
    "statements": {
      "patterns": [
        {
          "match": "\\b(wire|reg|sym)\\b\\s*([a-zA-Z_][a-zA-Z0-9_]*)?",
          "captures": {
            "1": { "name": "storage.type.vctx" },
            "2": { "name": "variable.other.vctx" }
          }
        },
        {
          "match": "\\b(when|elsewhen|otherwise|return)\\b",
          "name": "keyword.control.vctx"
        },
        {
          "comment": "Catch-all for variable declarations like 'name : type'",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(:)\\s*",
          "captures": {
            "1": { "name": "variable.other.vctx" },
            "2": { "name": "punctuation.separator.type.vctx" }
          }
        },
        { "include": "#expressions" }
      ]
    },
    "expressions": {
      "patterns": [
        { "include": "#comments" },
        { "include": "#literals" },
        { "include": "#named_connections" },
        { "include": "#operators" },
        { "include": "#types" },
        { "include": "#keywords" },
        { "include": "#function_calls" },
        { "include": "#identifiers" },
        { "include": "#punctuation" }
      ]
    },
    "named_connections": {
      "comment": "Highlight 'name' in 'name -- expr' as a parameter/tag",
      "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=--)",
      "name": "variable.parameter.connection.vctx"
    },
    "literals": {
      "patterns": [
        { "name": "constant.numeric.hex.vctx", "match": "\\b0x[0-9a-fA-F]+(_[0-9a-fA-F]+)*\\b" },
        { "name": "constant.numeric.binary.vctx", "match": "\\b0b[01]+(_[01]+)*\\b" },
        { "name": "constant.numeric.typed.vctx", "match": "\\b[0-9]+[a-zA-Z][a-zA-Z0-9]*\\b" },
        { "name": "constant.numeric.decimal.vctx", "match": "\\b[0-9]+(_[0-9]+)*\\b" },
        { "name": "constant.language.boolean.vctx", "match": "\\b(true|false)\\b" },
        {
          "name": "string.quoted.double.vctx",
          "begin": "\"", "end": "\"",
          "patterns": [ { "name": "constant.character.escape.vctx", "match": "\\\\." } ]
        }
      ]
    },
    "keywords": {
      "patterns": [
        { "name": "keyword.control.vctx", "match": "\\b(when|elsewhen|otherwise|return)\\b" },
        { "name": "storage.type.vctx", "match": "\\b(wire|reg|sym)\\b" },
        { "name": "keyword.other.cast.vctx", "match": "\\b(as)\\b" },
        { "name": "storage.modifier.direction.vctx", "match": "\\b(to|from)\\b" }
      ]
    },
    "operators": {
      "patterns": [
        { "name": "keyword.operator.assignment.vctx", "match": "(:=|<=|=)" },
        { "name": "keyword.operator.comparison.vctx", "match": "(<==|>==|!==|==|<=|>=|<|>)" },
        { "name": "keyword.operator.logical.vctx", "match": "(\\|\\||&&|!)" },
        { "name": "keyword.operator.bitwise.vctx", "match": "(\\||\\^|&|~)" },
        { "name": "keyword.operator.arithmetic.vctx", "match": "(\\+|\\-|\\*|/|%)" },
        { "name": "keyword.operator.shift.vctx", "match": "(<<|>>)" },
        { "name": "keyword.operator.connection.vctx", "match": "(--)" },
        { "name": "keyword.operator.ternary.vctx", "match": "(\\?|:)" },
        { "name": "keyword.operator.member.vctx", "match": "(\\.|\\.\\.)" },
        { "name": "keyword.operator.arrow.vctx", "match": "(->)" }
      ]
    },
    "types": {
      "patterns": [
        {
          "comment": "Explicit primitives like u8, s32",
          "match": "\\b[us][0-9]+\\b",
          "name": "support.type.primitive.vctx"
        },
        {
          "comment": "Types detected by context (: or as)",
          "match": "(?<=:|\\bas)\\s*([a-zA-Z_][a-zA-Z0-9_]*)",
          "captures": { "1": { "name": "support.type.vctx" } }
        },
        {
          "begin": "<", "end": ">",
          "patterns": [
             { "match": ",", "name": "punctuation.separator.vctx" },
             { "include": "#types" },
             { "include": "#expressions" }
          ]
        }
      ]
    },
    "generics": {
      "begin": "<", "end": ">",
      "patterns": [
        { "match": "[a-zA-Z_][a-zA-Z0-9_]*", "name": "entity.name.type.parameter.vctx" },
        { "match": ",", "name": "punctuation.separator.vctx" }
      ]
    },
    "function_calls": {
      "patterns": [
        {
          "comment": "Intrinsic functions",
          "match": "\\b(assert|assume|cover|cycle|reset|print)\\b",
          "name": "support.function.builtin.vctx"
        },
        {
          "comment": "User defined functions",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=\\()",
          "captures": { "1": { "name": "entity.name.function.call.vctx" } }
        }
      ]
    },
    "identifiers": {
      "patterns": [
        {
          "comment": "Implicit Globals (clk, rst)",
          "match": "\\b(clk|rst)\\b",
          "name": "variable.language.vctx"
        },
        {
            "comment": "Field access (the 'bar' in 'foo.bar')",
            "match": "(\\.)([a-zA-Z_][a-zA-Z0-9_]*)",
            "captures": {
                "1": { "name": "punctuation.accessor.vctx" },
                "2": { "name": "variable.other.property.vctx" }
            }
        },
        {
          "comment": "Constants (ALL_CAPS)",
          "match": "\\b[A-Z][A-Z0-9_]*\\b",
          "name": "variable.other.constant.vctx"
        },
        {
          "comment": "Standard identifiers",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b",
          "name": "variable.other.vctx"
        }
      ]
    },
    "punctuation": {
      "patterns": [
        { "name": "punctuation.section.block.begin.vctx", "match": "\\{" },
        { "name": "punctuation.section.block.end.vctx", "match": "\\}" },
        { "name": "punctuation.section.parens.begin.vctx", "match": "\\(" },
        { "name": "punctuation.section.parens.end.vctx", "match": "\\)" },
        { "name": "punctuation.section.brackets.begin.vctx", "match": "\\[" },
        { "name": "punctuation.section.brackets.end.vctx", "match": "\\]" },
        { "name": "punctuation.separator.vctx", "match": "," },
        { "name": "punctuation.terminator.vctx", "match": ";" }
      ]
    }
  }
}